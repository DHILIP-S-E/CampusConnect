<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - CampusConnect</title>
    <link rel="stylesheet" href="../css/styles.css">
    <script src="../js/config.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/getCurrentUser.js"></script>
    <script src="../js/admin.js"></script> <!-- Added admin functions -->
</head>
<body class="role-admin">
    <div class="container">
        <nav class="nav">
            <div class="nav-container">
                <div class="nav-logo">CampusConnect</div>
                <ul class="nav-menu">
                    <li class="nav-item"><a href="#" class="nav-link" id="nav-dashboard">Dashboard</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" id="nav-users">Users</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" id="nav-entry-logs">Entry Logs</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" id="nav-certificates">Certificates</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" id="nav-notifications">Notifications</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" id="nav-events">Events</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" id="nav-departments">Departments</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" id="nav-courses">Courses</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" id="nav-settings">Settings</a></li>
                    <li class="nav-item"><a href="#" class="nav-link" id="logout-btn">Logout</a></li>
                </ul>
            </div>
        </nav>

        <header>
            <h1>Admin Dashboard</h1>
            <p>Welcome, <span id="admin-name">Admin</span></p>
        </header>

        <main>
            <!-- Dashboard Overview Section -->
            <section id="dashboard-section" class="dashboard-section">
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-icon">üë®‚Äçüéì</div>
                        <div class="stat-info">
                            <h3>Students</h3>
                            <p class="stat-number" id="total-students">0</p>
                            <p class="stat-label">Registered Students</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üë®‚Äçüè´</div>
                        <div class="stat-info">
                            <h3>Faculty</h3>
                            <p class="stat-number" id="total-faculty">0</p>
                            <p class="stat-label">Faculty Members</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìö</div>
                        <div class="stat-info">
                            <h3>Courses</h3>
                            <p class="stat-number" id="total-courses">0</p>
                            <p class="stat-label">Active Courses</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üè¢</div>
                        <div class="stat-info">
                            <h3>Departments</h3>
                            <p class="stat-number" id="total-departments">0</p>
                            <p class="stat-label">Academic Departments</p>
                        </div>
                    </div>
                </div>
                
                <div class="dashboard-row">
                    <div class="card">
                        <h2>System Overview</h2>
                        <p>Welcome to the CampusConnect Admin Dashboard. From here, you can manage all aspects of the college management system.</p>
                        <p>Use the navigation menu to access different sections of the admin panel.</p>
                        <ul>
                            <li><strong>Users:</strong> Manage students, faculty, and admin accounts</li>
                            <li><strong>Departments:</strong> Add, edit, or remove academic departments</li>
                            <li><strong>Courses:</strong> Manage course offerings and assignments</li>
                            <li><strong>Settings:</strong> Configure system settings and preferences</li>
                        </ul>
                    </div>
                    
                    <div class="card">
                        <h2>Recent Activities</h2>
                        <div id="recent-activities">
                            <div class="activity-item">
                                <h4>New User Registration</h4>
                                <p>A new faculty member has registered.</p>
                                <p class="activity-meta">Today, 10:30 AM</p>
                            </div>
                            <div class="activity-item">
                                <h4>Course Added</h4>
                                <p>Introduction to Computer Science course was added.</p>
                                <p class="activity-meta">Yesterday, 2:15 PM</p>
                            </div>
                            <div class="activity-item">
                                <h4>System Update</h4>
                                <p>System was updated to the latest version.</p>
                                <p class="activity-meta">Oct 15, 2023</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Users Section -->
            <section id="users-section" class="dashboard-section" style="display: none;">
                <div class="card">
                    <h2>Add New User</h2>
                    <form id="add-user-form">
                        <div class="form-group">
                            <label for="user-name">Full Name</label>
                            <input type="text" id="user-name" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="user-email">Email</label>
                            <input type="email" id="user-email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="user-username">Username</label>
                            <input type="text" id="user-username" name="username" required>
                        </div>
                        <div class="form-group">
                            <label for="user-password">Password</label>
                            <input type="password" id="user-password" name="password" required>
                        </div>
                        <div class="form-group">
                            <label for="user-role">Role</label>
                            <select id="user-role" name="role" required>
                                <option value="">Select Role</option>
                                <option value="student">Student</option>
                                <option value="faculty">Faculty</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                        <div class="form-group student-fields" style="display: none;">
                            <label for="user-department">Department</label>
                            <input type="text" id="user-department" name="department">
                        </div>
                        <div class="form-group student-fields" style="display: none;">
                            <label for="user-year">Year</label>
                            <input type="text" id="user-year" name="year">
                        </div>
                        <button type="submit" class="btn btn-primary">Add User</button>
                    </form>
                    <div id="user-message" class="message"></div>
                </div>

                <div class="card">
                    <h2>View All Students</h2>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Department</th>
                                <th>Year</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="students-table-body">
                            <!-- Student data will be loaded here by JavaScript -->
                            <tr><td colspan="6">Loading students...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Entry Logs Section -->
            <section id="entry-logs-section" class="dashboard-section" style="display: none;">
                <div class="card">
                    <h2>Add New Entry Log</h2>
                    <form id="add-log-form">
                        <div class="form-group">
                            <label for="log-type">Log Type</label>
                            <select id="log-type" name="logType" required>
                                <option value="">Select Type</option>
                                <option value="visitor">Visitor</option>
                                <option value="event_entry">Event Entry</option>
                                <option value="delivery">Delivery</option>
                                <option value="maintenance">Maintenance</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="log-name">Name / Event / Item</label>
                            <input type="text" id="log-name" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="log-date">Date</label>
                            <input type="date" id="log-date" name="date" required>
                        </div>
                        <div class="form-group">
                            <label for="log-time">Time</label>
                            <input type="time" id="log-time" name="time" required>
                        </div>
                        <div class="form-group">
                            <label for="log-purpose">Purpose / Details</label>
                            <textarea id="log-purpose" name="purpose" rows="3" required></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Log Entry</button>
                    </form>
                    <div id="log-message" class="message"></div>
                </div>
                <div class="card">
                    <h2>View Entry Logs</h2>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Name/Event</th>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Purpose</th>
                            </tr>
                        </thead>
                        <tbody id="logs-table-body">
                            <!-- Log data will be loaded here -->
                            <tr><td colspan="5">Loading logs...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Certificates Section -->
            <section id="certificates-section" class="dashboard-section" style="display: none;">
                <div class="card">
                    <h2>Issue Certificate</h2>
                    <form id="issue-certificate-form">
                        <div class="form-group">
                            <label for="certificate-student">Student</label>
                            <select id="certificate-student" name="studentId" required>
                                <option value="">Select Student</option>
                                <!-- Students will be loaded here by loadStudentsForCertificate() -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="certificate-type">Certificate Type</label>
                            <input type="text" id="certificate-type" name="certificateType" placeholder="e.g., Course Completion, Dean's List" required>
                        </div>
                        <div class="form-group">
                            <label for="certificate-course">Course/Event Name (if applicable)</label>
                            <input type="text" id="certificate-course" name="courseName">
                        </div>
                        <div class="form-group">
                            <label for="certificate-date">Issue Date</label>
                            <input type="date" id="certificate-date" name="issueDate" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Issue Certificate</button>
                    </form>
                    <div id="certificate-message" class="message"></div>
                </div>
            </section>

            <!-- Notifications Section -->
            <section id="notifications-section" class="dashboard-section" style="display: none;">
                <div class="card">
                    <h2>Send Campus-Wide Notification</h2>
                    <form id="send-notification-form">
                        <div class="form-group">
                            <label for="notification-title">Title</label>
                            <input type="text" id="notification-title" name="title" required>
                        </div>
                        <div class="form-group">
                            <label for="notification-message-text">Message</label> <!-- Changed ID to avoid conflict with other message elements -->
                            <textarea id="notification-message-text" name="message" rows="4" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="notification-target">Target Audience</label>
                            <select id="notification-target" name="target" required>
                                <option value="all">All Users</option>
                                <option value="students">Students Only</option>
                                <option value="faculty">Faculty Only</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="notification-priority">Priority</label>
                            <select id="notification-priority" name="priority" required>
                                <option value="normal">Normal</option>
                                <option value="high">High</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">Send Notification</button>
                    </form>
                    <div id="notification-status-message" class="message"></div>
                </div>
            </section>

            <!-- Events Section -->
            <section id="events-section" class="dashboard-section" style="display: none;">
                <div class="card">
                    <h2>Create New Event</h2>
                    <form id="create-event-form">
                        <div class="form-group">
                            <label for="event-title">Event Title</label>
                            <input type="text" id="event-title" name="title" required>
                        </div>
                        <div class="form-group">
                            <label for="event-description">Description</label>
                            <textarea id="event-description" name="description" rows="3" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="event-start-date">Start Date & Time</label>
                            <input type="datetime-local" id="event-start-date" name="startDate" required>
                        </div>
                        <div class="form-group">
                            <label for="event-end-date">End Date & Time</label>
                            <input type="datetime-local" id="event-end-date" name="endDate" required>
                        </div>
                        <div class="form-group">
                            <label for="event-location">Location</label>
                            <input type="text" id="event-location" name="location" required>
                        </div>
                        <div class="form-group">
                            <label for="event-organizer">Organizer (Department/Club)</label>
                            <input type="text" id="event-organizer" name="organizer" required>
                        </div>
                        <div class="form-group">
                            <label for="event-capacity">Capacity</label>
                            <input type="number" id="event-capacity" name="capacity" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="event-type">Event Type</label>
                            <select id="event-type" name="type" required>
                                <option value="">Select Type</option>
                                <option value="workshop">Workshop</option>
                                <option value="seminar">Seminar</option>
                                <option value="conference">Conference</option>
                                <option value="cultural">Cultural</option>
                                <option value="sports">Sports</option>
                                <option value="tech-fest">Tech Fest</option>
                                <option value="hackathon">Hackathon</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="event-visibility">Visibility</label>
                            <select id="event-visibility" name="isPublic" required>
                                <option value="true">Public (Visible to all)</option>
                                <option value="false">Private (Invite only or specific groups)</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">Create Event</button>
                    </form>
                    <div id="event-message" class="message"></div>
                </div>
                <div class="card">
                    <h2>Manage Events</h2>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Date</th>
                                <th>Location</th>
                                <th>Type</th>
                                <th>Capacity</th>
                                <th>Registered</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="events-table-body">
                            <!-- Event data will be loaded here -->
                            <tr><td colspan="8">Loading events...</td></tr>
                        </tbody>
                    </table>
                </div>
                 <div class="card">
                    <h2>Event Analytics</h2>
                    <div class="charts-container"> <!-- Basic container for charts -->
                        <div class="chart-placeholder" id="events-by-type-chart"><p>Events by Type Chart (Placeholder)</p></div>
                        <div class="chart-placeholder" id="popular-locations-chart"><p>Popular Locations Chart (Placeholder)</p></div>
                        <div class="chart-placeholder" id="attendance-rate-chart"><p>Attendance Rate Chart (Placeholder)</p></div>
                        <div class="chart-placeholder" id="registration-trends-chart"><p>Registration Trends Chart (Placeholder)</p></div>
                    </div>
                </div>
            </section>

            <!-- Departments Section -->
            <section id="departments-section" class="dashboard-section" style="display: none;">
                <div class="card">
                    <h2>Add New Department</h2>
                    <form id="add-department-form">
                        <div class="form-group">
                            <label for="dept-name">Department Name</label>
                            <input type="text" id="dept-name" name="deptName" required>
                        </div>
                        <div class="form-group">
                            <label for="dept-code">Department Code</label>
                            <input type="text" id="dept-code" name="deptCode" required>
                        </div>
                        <div class="form-group">
                            <label for="dept-head">Department Head (Optional)</label>
                            <input type="text" id="dept-head" name="deptHead">
                        </div>
                        <div class="form-group">
                            <label for="dept-description">Description (Optional)</label>
                            <textarea id="dept-description" name="deptDescription" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Department</button>
                    </form>
                    <div id="department-message" class="message"></div>
                </div>

                <div class="card">
                    <h2>Manage Departments</h2>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Code</th>
                                <th>Head</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="departments-table-body">
                            <!-- Department data will be loaded here by JavaScript -->
                            <tr><td colspan="5">Loading departments...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Courses Section -->
            <section id="courses-section" class="dashboard-section" style="display: none;">
                <div class="card">
                    <h2>Add New Course</h2>
                    <form id="add-course-form">
                        <div class="form-group">
                            <label for="course-name">Course Name</label>
                            <input type="text" id="course-name" name="courseName" required>
                        </div>
                        <div class="form-group">
                            <label for="course-code">Course Code</label>
                            <input type="text" id="course-code" name="courseCode" required>
                        </div>
                        <div class="form-group">
                            <label for="course-department">Department</label>
                            <select id="course-department" name="courseDepartment" required>
                                <option value="">Select Department</option>
                                <!-- Departments will be loaded here by JavaScript -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="course-credits">Credits</label>
                            <input type="number" id="course-credits" name="courseCredits" min="1" max="5" required>
                        </div>
                        <div class="form-group">
                            <label for="course-instructor">Instructor (Optional)</label>
                            <input type="text" id="course-instructor" name="courseInstructor">
                        </div>
                        <div class="form-group">
                            <label for="course-description">Description (Optional)</label>
                            <textarea id="course-description" name="courseDescription" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Add Course</button>
                    </form>
                    <div id="course-message" class="message"></div>
                </div>

                <div class="card">
                    <h2>Manage Courses</h2>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Code</th>
                                <th>Department</th>
                                <th>Credits</th>
                                <th>Instructor</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="courses-table-body">
                            <!-- Course data will be loaded here by JavaScript -->
                            <tr><td colspan="7">Loading courses...</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Settings Section -->
            <section id="settings-section" class="dashboard-section" style="display: none;">
                <div class="card">
                    <h2>Application Data Management</h2>
                    <p>Manage application data stored in your browser's local storage.</p>
                    <div class="form-group">
                        <button id="clear-local-storage-btn" class="btn btn-danger">Clear All Application Data</button>
                        <p class="help-text">Warning: This will remove all users, departments, courses, logs, and other data stored by this application in your browser. This action cannot be undone.</p>
                    </div>
                    <div id="settings-message" class="message"></div>
                </div>
                 <div class="card">
                    <h2>Theme Settings (Conceptual)</h2>
                    <p>Theme settings would go here (e.g., dark mode toggle).</p>
                    <div class="form-group">
                        <label for="theme-select">Select Theme:</label>
                        <select id="theme-select" name="theme">
                            <option value="light">Light Mode</option>
                            <option value="dark" disabled>Dark Mode (Coming Soon)</option>
                        </select>
                    </div>
                </div>
            </section>
        </main>

        <footer>
            <p>&copy; 2023 CampusConnect. All rights reserved.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user has permission to access this page
            const user = getCurrentUser();
            if (!user || user.role !== 'admin') {
                alert('You do not have permission to access this page.');
                window.location.href = '../index.html';
                return;
            }
            
            // Set admin name
            document.getElementById('admin-name').textContent = user.name || 'Admin';

            // Logic to show/hide student-specific fields in Add User form
            const userRoleSelect = document.getElementById('user-role');
            const studentFields = document.querySelectorAll('.student-fields');

            if (userRoleSelect) {
                userRoleSelect.addEventListener('change', function() {
                    if (this.value === 'student') {
                        studentFields.forEach(field => field.style.display = 'block');
                        // Make department and year required for students
                        document.getElementById('user-department').required = true;
                        document.getElementById('user-year').required = true;
                    } else {
                        studentFields.forEach(field => field.style.display = 'none');
                        document.getElementById('user-department').required = false;
                        document.getElementById('user-year').required = false;
                    }
                });
                // Trigger change event on load in case a role is pre-selected (e.g. form remembers last state)
                if(userRoleSelect.value === 'student'){
                    studentFields.forEach(field => field.style.display = 'block');
                    document.getElementById('user-department').required = true;
                    document.getElementById('user-year').required = true;
                }
            }
            
            // Setup navigation
            document.getElementById('nav-dashboard').addEventListener('click', function(e) {
                e.preventDefault();
                showSection('dashboard-section');
            });
            
            document.getElementById('nav-users').addEventListener('click', function(e) {
                e.preventDefault();
                showSection('users-section');
                if (typeof loadStudents === 'function') {
                    loadStudents();
                } else {
                    console.error('loadStudents function not found.');
                    const studentsTableBody = document.getElementById('students-table-body');
                    if (studentsTableBody) {
                        studentsTableBody.innerHTML = '<tr><td colspan="6" class="error-message">Error loading students. Function not available.</td></tr>';
                    }
                }
            });

            // Add User form submission
            const addUserForm = document.getElementById('add-user-form');
            if (addUserForm) {
                addUserForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    if (typeof addUser === 'function') {
                        addUser();
                    } else {
                        console.error('addUser function not found.');
                        const userMessage = document.getElementById('user-message');
                        if (userMessage) {
                            userMessage.textContent = 'Error: Add user functionality not available.';
                            userMessage.className = 'message error-message';
                        }
                    }
                });
            }
            
            // Entry Logs
            document.getElementById('nav-entry-logs').addEventListener('click', function(e) {
                e.preventDefault();
                showSection('entry-logs-section');
                if (typeof loadLogs === 'function') {
                    loadLogs();
                } else {
                    console.error('loadLogs function not found.');
                    document.getElementById('logs-table-body').innerHTML = '<tr><td colspan="5" class="error-message">Error loading logs. Function not available.</td></tr>';
                }
            });
            const addLogForm = document.getElementById('add-log-form');
            if (addLogForm) {
                addLogForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    if (typeof addLog === 'function') {
                        addLog();
                    } else {
                        console.error('addLog function not found.');
                        document.getElementById('log-message').textContent = 'Error: Add log functionality not available.';
                        document.getElementById('log-message').className = 'message error-message';
                    }
                });
            }

            // Certificates
            document.getElementById('nav-certificates').addEventListener('click', function(e) {
                e.preventDefault();
                showSection('certificates-section');
                if (typeof loadStudentsForCertificate === 'function') {
                    loadStudentsForCertificate();
                } else {
                    console.error('loadStudentsForCertificate function not found.');
                    // Optionally, display an error in the student dropdown or a message
                }
            });
            const issueCertificateForm = document.getElementById('issue-certificate-form');
            if (issueCertificateForm) {
                issueCertificateForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    if (typeof issueCertificate === 'function') {
                        issueCertificate();
                    } else {
                        console.error('issueCertificate function not found.');
                        document.getElementById('certificate-message').textContent = 'Error: Issue certificate functionality not available.';
                        document.getElementById('certificate-message').className = 'message error-message';
                    }
                });
            }

            // Notifications
            document.getElementById('nav-notifications').addEventListener('click', function(e) {
                e.preventDefault();
                showSection('notifications-section');
            });
            const sendNotificationForm = document.getElementById('send-notification-form');
            if (sendNotificationForm) {
                sendNotificationForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    if (typeof sendNotification === 'function') {
                        // Correct the function call to pass the message element ID
                        sendNotification('notification-status-message'); 
                    } else {
                        console.error('sendNotification function not found.');
                        document.getElementById('notification-status-message').textContent = 'Error: Send notification functionality not available.';
                        document.getElementById('notification-status-message').className = 'message error-message';
                    }
                });
            }

            // Events
            document.getElementById('nav-events').addEventListener('click', function(e) {
                e.preventDefault();
                showSection('events-section');
                if (typeof loadEvents === 'function') {
                    loadEvents();
                } else {
                    console.error('loadEvents function not found.');
                    document.getElementById('events-table-body').innerHTML = '<tr><td colspan="8" class="error-message">Error loading events. Function not available.</td></tr>';
                }
            });
            const createEventForm = document.getElementById('create-event-form');
            if (createEventForm) {
                createEventForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    if (typeof createEvent === 'function') {
                        createEvent();
                    } else {
                        console.error('createEvent function not found.');
                        document.getElementById('event-message').textContent = 'Error: Create event functionality not available.';
                        document.getElementById('event-message').className = 'message error-message';
                    }
                });
            }
            
            document.getElementById('nav-departments').addEventListener('click', function(e) {
                e.preventDefault();
                showSection('departments-section');
                if (typeof loadDepartments === 'function') {
                    loadDepartments();
                } else {
                    console.error('loadDepartments function not found.');
                    document.getElementById('departments-table-body').innerHTML = '<tr><td colspan="5" class="error-message">Error loading departments. Function not available.</td></tr>';
                }
            });
            const addDepartmentForm = document.getElementById('add-department-form');
            if (addDepartmentForm) {
                addDepartmentForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    if (typeof addDepartment === 'function') {
                        addDepartment();
                    } else {
                        console.error('addDepartment function not found.');
                        document.getElementById('department-message').textContent = 'Error: Add department functionality not available.';
                        document.getElementById('department-message').className = 'message error-message';
                    }
                });
            }
            
            document.getElementById('nav-courses').addEventListener('click', function(e) {
                e.preventDefault();
                showSection('courses-section');
                if (typeof loadCourses === 'function') {
                    loadCourses();
                } else {
                    console.error('loadCourses function not found.');
                    document.getElementById('courses-table-body').innerHTML = '<tr><td colspan="7" class="error-message">Error loading courses. Function not available.</td></tr>';
                }
                if (typeof loadDepartmentsForCourseForm === 'function') { // To populate department dropdown in course form
                    loadDepartmentsForCourseForm();
                }
            });
            const addCourseForm = document.getElementById('add-course-form');
            if (addCourseForm) {
                addCourseForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    if (typeof addCourse === 'function') {
                        addCourse();
                    } else {
                        console.error('addCourse function not found.');
                        document.getElementById('course-message').textContent = 'Error: Add course functionality not available.';
                        document.getElementById('course-message').className = 'message error-message';
                    }
                });
            }
            
            document.getElementById('nav-settings').addEventListener('click', function(e) {
                e.preventDefault();
                showSection('settings-section');
                // Add event listener for the clear data button if it's now visible
                const clearDataBtn = document.getElementById('clear-local-storage-btn');
                if (clearDataBtn && !clearDataBtn.hasAttribute('listener')) { // Avoid adding multiple listeners
                    clearDataBtn.setAttribute('listener', 'true');
                    clearDataBtn.addEventListener('click', function() {
                        if (typeof clearAllApplicationData === 'function') {
                            clearAllApplicationData();
                        } else {
                            console.error('clearAllApplicationData function not found.');
                            document.getElementById('settings-message').textContent = 'Error: Clear data functionality not available.';
                            document.getElementById('settings-message').className = 'message error-message';
                        }
                    });
                }
            });
            
            document.getElementById('logout-btn').addEventListener('click', function(e) {
                e.preventDefault();
                logout();
            });
            
            // Load dashboard data
            if (typeof loadAdminDashboardData === 'function') {
                loadAdminDashboardData();
            } else {
                console.error('loadAdminDashboardData function not found in admin.js');
            }
        });
        
        // Show the specified section and hide others
        function showSection(sectionId) {
            // Hide all sections
            const sections = document.querySelectorAll('.dashboard-section');
            sections.forEach(section => {
                section.style.display = 'none';
            });
            
            // Show the selected section
            const sectionElement = document.getElementById(sectionId);
            if (sectionElement) {
                sectionElement.style.display = 'block';
            } else {
                console.error(`Section with ID ${sectionId} not found.`);
            }
        }
    </script>
</body>
</html>
